# 📂 目录树状结构功能 - 使用指南

## 🎉 新功能：真正的树状目录结构

ChromaCloud v1.2 现在支持**真正的树状目录结构**显示！

## ✨ 功能特点

### 1. **递归子目录显示**

现在当你创建 Folder Album 时，不仅会显示根文件夹，还会递归显示所有子文件夹：

```
📂 Folders (2)
  ├─ 📂 Lightroom_Exports (156)        ← 根文件夹（所有照片）
  │  ├─ 📁 2024_January (45)          ← 子文件夹（仅1月照片）
  │  ├─ 📁 2024_February (67)         ← 子文件夹（仅2月照片）
  │  └─ 📁 Portraits (44)             ← 子文件夹（仅肖像）
  │     └─ 📁 Studio (20)             ← 子子文件夹（仅工作室）
  │
  └─ 📂 Studio_Work (89)
     ├─ 📁 Client_A (34)
     └─ 📁 Client_B (55)
```

### 2. **展开/折叠**

- 点击文件夹名称前的 **▶** 箭头展开查看子文件夹
- 再次点击 **▼** 箭头折叠隐藏子文件夹
- 默认状态：根文件夹折叠，需要手动展开

### 3. **智能照片数量**

每个文件夹都显示包含的照片数量（包括子文件夹）：

- `📂 My_Photos (156)` - 包括所有子文件夹的156张照片
- `📁 2024_Jan (45)` - 仅该文件夹及其子文件夹的45张照片

### 4. **点击查看**

- **点击根文件夹** → 查看所有照片
- **点击子文件夹** → 仅查看该子文件夹的照片

### 5. **自动过滤**

- 只显示包含照片的文件夹
- 自动跳过空文件夹
- 自动跳过隐藏文件夹（以 `.` 开头）

## 🎯 使用场景

### 场景 1: Lightroom 按月份导出

```
Lightroom 导出结构：
C:\LR_Exports\
├── 2024_01\
│   ├── portrait_001.jpg
│   └── portrait_002.jpg
├── 2024_02\
│   └── landscape_001.jpg
└── 2024_03\
    └── event_001.jpg

ChromaCloud 显示：
📂 Folders (1)
  └─ 📂 LR_Exports (4)
     ├─ 📁 2024_01 (2)
     ├─ 📁 2024_02 (1)
     └─ 📁 2024_03 (1)
```

**操作：**
1. 点击 `LR_Exports` → 查看所有4张照片
2. 点击 `2024_01` → 仅查看1月的2张照片
3. 点击 `2024_02` → 仅查看2月的1张照片

### 场景 2: 项目分类

```
项目结构：
D:\Studio\
├── Client_A\
│   ├── Raw\
│   │   └── img001.jpg
│   └── Edited\
│       └── img001_edit.jpg
└── Client_B\
    └── Final\
        └── img002.jpg

ChromaCloud 显示：
📂 Folders (1)
  └─ 📂 Studio (3)
     ├─ 📁 Client_A (2)
     │  ├─ 📁 Raw (1)
     │  └─ 📁 Edited (1)
     └─ 📁 Client_B (1)
        └─ 📁 Final (1)
```

**操作：**
1. 点击 `Studio` → 查看所有客户的照片
2. 点击 `Client_A` → 仅查看客户A的照片
3. 点击 `Client_A/Edited` → 仅查看已编辑的照片

### 场景 3: Lightroom 迭代测试

```
测试结构：
C:\LR_Tests\
├── Baseline\
│   └── test_v1.jpg
├── Orange_15\
│   └── test_v2.jpg
├── Orange_25\
│   └── test_v3.jpg
└── Final\
    └── test_final.jpg

ChromaCloud 显示：
📂 Folders (1)
  └─ 📂 LR_Tests (4)
     ├─ 📁 Baseline (1)
     ├─ 📁 Orange_15 (1)
     ├─ 📁 Orange_25 (1)
     └─ 📁 Final (1)
```

**操作：**
1. 点击不同文件夹快速切换版本
2. 对比不同版本的分析结果
3. 决定最佳的 Orange Luminance 值

## 🎨 UI 说明

### 图标含义

| 图标 | 含义 | 说明 |
|-----|------|------|
| 📂 | 根文件夹 | Folder Album 的根目录 |
| 📁 | 子文件夹 | 子目录 |
| ▶ | 已折叠 | 点击展开查看子文件夹 |
| ▼ | 已展开 | 点击折叠隐藏子文件夹 |
| (数字) | 照片数量 | 该文件夹包含的照片总数 |

### 颜色和样式

- **根文件夹** - 显示在 "📂 Folders" 区域下
- **子文件夹** - 缩进显示，表示层级关系
- **选中状态** - 高亮显示当前选中的文件夹

## 🔧 技术特性

### 性能优化

1. **智能扫描** - 只在创建/刷新时扫描一次
2. **延迟加载** - 只在展开时加载子目录
3. **缓存机制** - 照片数量缓存，避免重复计算
4. **深度限制** - 默认最多10层深度，防止无限递归

### 文件夹过滤

自动跳过：
- 隐藏文件夹（`.git`, `.vscode` 等）
- 系统文件夹（`__pycache__` 等）
- 空文件夹（不包含照片）
- 无权限访问的文件夹

### 照片统计

- **递归统计** - 包括所有子文件夹的照片
- **实时更新** - 添加/删除照片后自动更新
- **数据库同步** - 只显示已分析的照片

## 💡 使用技巧

### 技巧 1: 快速导航

```
1. 展开根文件夹查看结构
2. 点击子文件夹快速定位
3. 使用键盘方向键上下导航
4. 使用 Space/Enter 展开/折叠
```

### 技巧 2: 按时间组织

```
建议的文件夹结构：
Photos\
├── 2024\
│   ├── 01_January\
│   ├── 02_February\
│   └── 03_March\
└── 2023\
    └── ...

这样可以：
- 快速找到特定月份的照片
- 按时间线浏览
- 方便归档管理
```

### 技巧 3: 按项目组织

```
建议的文件夹结构：
Projects\
├── Project_A\
│   ├── Raw\
│   ├── Edited\
│   └── Final\
├── Project_B\
│   └── ...

这样可以：
- 项目独立管理
- 工作流程清晰
- 版本控制方便
```

## 🚀 工作流集成

### Lightroom → ChromaCloud

```
1. Lightroom 中调整照片
2. Export 到结构化文件夹
   例如：C:\LR_Exports\2024_02\test_v1.jpg
3. ChromaCloud 自动检测并分析
4. 在树状结构中找到并点击
   📂 Folders
     └─ 📂 LR_Exports
        └─ 📁 2024_02  ← 点击这里
5. 查看该月份的所有分析结果
```

### 批量对比

```
1. 将不同版本导出到不同子文件夹
2. 在 ChromaCloud 中展开文件夹树
3. 依次点击每个子文件夹查看
4. 对比分析数据
5. 确定最佳版本
```

## 🎊 与之前的区别

### 之前（v1.1）

```
📂 Folders (1)
  └─ 📂 My_Photos (156)  ← 只能看到总数
```

**问题：**
- 无法知道照片分布在哪些子文件夹
- 无法按子文件夹筛选
- 混在一起难以管理

### 现在（v1.2）

```
📂 Folders (1)
  └─ 📂 My_Photos (156)  ← 点击查看全部
     ├─ 📁 January (45)  ← 点击仅查看1月
     ├─ 📁 February (67) ← 点击仅查看2月
     └─ 📁 March (44)    ← 点击仅查看3月
```

**改进：**
- ✅ 清晰的目录结构
- ✅ 按需查看特定文件夹
- ✅ 支持无限层级
- ✅ 展开/折叠自由控制

## 📝 注意事项

1. **首次加载可能较慢** - 需要扫描所有子文件夹统计照片数量
2. **大量子文件夹** - 建议使用搜索或过滤功能
3. **权限问题** - 无权限的文件夹会自动跳过
4. **照片数量更新** - 添加新照片后需要刷新（重新打开应用）

## 🔄 更新说明

**版本**: v1.2  
**新增功能**:
- ✅ 递归目录树结构
- ✅ 子文件夹展开/折叠
- ✅ 点击子文件夹筛选照片
- ✅ 智能照片数量统计
- ✅ 自动过滤空文件夹

**向后兼容**:
- ✅ 现有 Folder Albums 自动升级
- ✅ 无需重新创建
- ✅ 数据库结构不变

---

**开始使用真正的树状结构！** 🌲✨

*更新日期：2026-02-01*  
*版本：v1.2*
