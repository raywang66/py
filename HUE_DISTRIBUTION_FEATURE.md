# Hue Distribution Comparison Feature

## æ¦‚è¿° (Overview)

å®žçŽ°äº†ç±»ä¼¼äºŽ "Lightness Distribution Comparison" çš„ "Hue Distribution Comparison" åŠŸèƒ½ï¼Œå¯ä»¥ç›´è§‚åœ°æ˜¾ç¤ºæ¯å¼ ç…§ç‰‡åœ¨ä¸åŒè‰²è°ƒåŒºé—´çš„ç™¾åˆ†æ¯”åˆ†å¸ƒã€‚

## è‰²è°ƒåŒºé—´å®šä¹‰ (Hue Range Definition)

åŸºäºŽä¸“ä¸šçš„è‚¤è‰²åˆ†æžï¼Œå®šä¹‰äº†ä»¥ä¸‹6ä¸ªè‰²è°ƒåŒºé—´ï¼š

| åŒºé—´åç§° | è‰²è°ƒèŒƒå›´ | é¢œè‰² | å«ä¹‰ |
|---------|---------|------|------|
| Very Red (å¤ªçº¢) | 0-10Â°, 350-360Â° | æ·±çº¢è‰² (#8B0000) | éžå¸¸çº¢çš„è‚¤è‰²ï¼Œå¯èƒ½è¿‡åº¦æ›å…‰æˆ–è¡€ç®¡å¯è§ |
| Red-Orange (åçº¢) | 10-20Â° | æµ…çº¢è‰² (#CD5C5C) | åçº¢çš„è‚¤è‰²ï¼Œå¥åº·çº¢æ¶¦ |
| Normal (æ­£å¸¸) | 20-30Â° | æ£•è¤è‰² (#D2B48C) | æ­£å¸¸çš„äºšæ´²è‚¤è‰²èŒƒå›´ |
| Yellow (åé»„) | 30-40Â° | é‡‘é»„è‰² (#DAA520) | åé»„çš„è‚¤è‰² |
| Very Yellow (å¤ªé»„) | 40-60Â° | äº®é»„è‰² (#FFD700) | éžå¸¸é»„çš„è‚¤è‰²ï¼Œå¯èƒ½é»„ç–¸æˆ–å…‰ç…§é—®é¢˜ |
| Abnormal (å¼‚å¸¸) | 60-350Â° | ç°è‰² (#696969) | å¼‚å¸¸è‰²è°ƒï¼Œå¯èƒ½æ˜¯ç»¿è‰²ã€è“è‰²ç­‰ |

## ä¿®æ”¹çš„æ–‡ä»¶ (Modified Files)

### 1. CC_MainApp_v2.py

#### æ‰¹é‡åˆ†æž (Batch Processing)
åœ¨ `CC_BatchProcessingThread.run()` æ–¹æ³•ä¸­æ·»åŠ äº†è‰²è°ƒåˆ†å¸ƒè®¡ç®—ï¼š

```python
# Calculate hue distribution
hue = point_cloud[:, 0]
hue_very_red = (((hue >= 0) & (hue < 10)) | (hue >= 350)).sum() / len(hue) * 100
hue_red_orange = ((hue >= 10) & (hue < 20)).sum() / len(hue) * 100
hue_normal = ((hue >= 20) & (hue < 30)).sum() / len(hue) * 100
hue_yellow = ((hue >= 30) & (hue < 40)).sum() / len(hue) * 100
hue_very_yellow = ((hue >= 40) & (hue < 60)).sum() / len(hue) * 100
hue_abnormal = ((hue >= 60) & (hue < 350)).sum() / len(hue) * 100
```

#### å•å¼ ç…§ç‰‡åˆ†æž (Single Photo Analysis)
åœ¨ `_on_analysis_finished()` æ–¹æ³•ä¸­æ·»åŠ äº†ç›¸åŒçš„è‰²è°ƒåˆ†å¸ƒè®¡ç®—ï¼Œå¹¶åœ¨UIä¸­æ˜¾ç¤ºï¼š

```python
f"ðŸŽ¨ Hue Distribution:\n"
f"  Very Red (0-10Â°, 350-360Â°): {hue_very_red:.1f}%\n"
f"  Red-Orange (10-20Â°): {hue_red_orange:.1f}%\n"
f"  Normal (20-30Â°): {hue_normal:.1f}%\n"
f"  Yellow (30-40Â°): {hue_yellow:.1f}%\n"
f"  Very Yellow (40-60Â°): {hue_very_yellow:.1f}%\n"
f"  Abnormal (60-350Â°): {hue_abnormal:.1f}%"
```

#### æ•°æ®åº“ä¿å­˜ (Database Saving)
æ›´æ–°äº† `_on_batch_finished()` æ–¹æ³•ï¼Œå°†è‰²è°ƒåˆ†å¸ƒæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ï¼š

```python
analysis_data = {
    # ...existing fields...
    'hue_very_red': result['hue_very_red'],
    'hue_red_orange': result['hue_red_orange'],
    'hue_normal': result['hue_normal'],
    'hue_yellow': result['hue_yellow'],
    'hue_very_yellow': result['hue_very_yellow'],
    'hue_abnormal': result['hue_abnormal']
}
```

### 2. CC_StatisticsWindow.py

#### æ–°å¢žæ ‡ç­¾é¡µ (New Tab)
æ·»åŠ äº† "ðŸŒˆ Hue Comparison" æ ‡ç­¾é¡µï¼š

```python
# Tab 3: Hue Distribution Comparison (NEW)
self.hue_comparison_tab = self._create_chart_tab()
self.tabs.addTab(self.hue_comparison_tab, "ðŸŒˆ Hue Comparison")
```

#### æ–°å¢žç»˜å›¾æ–¹æ³• (New Plot Method)
å®žçŽ°äº† `_plot_hue_comparison()` æ–¹æ³•ï¼Œåˆ›å»ºå †å æŸ±çŠ¶å›¾æ˜¾ç¤ºè‰²è°ƒåˆ†å¸ƒï¼š

**ç‰¹ç‚¹ï¼š**
- 6å±‚å †å æŸ±çŠ¶å›¾ï¼Œæ¯å±‚ä»£è¡¨ä¸€ä¸ªè‰²è°ƒåŒºé—´
- ä½¿ç”¨ä¸“ä¸šçš„é¢œè‰²ç¼–ç ï¼ˆæ·±çº¢â†’æµ…çº¢â†’æ£•è¤â†’é‡‘é»„â†’äº®é»„â†’ç°è‰²ï¼‰
- æ”¯æŒæ‚¬åœæ˜¾ç¤ºç…§ç‰‡ç¼©ç•¥å›¾ï¼ˆä¸Ž Lightness Comparison ä¸€è‡´ï¼‰
- è‡ªåŠ¨é‡‡æ ·ï¼šè¶…è¿‡50å¼ ç…§ç‰‡æ—¶è‡ªåŠ¨é‡‡æ ·æ˜¾ç¤º
- è·³è¿‡æ²¡æœ‰è‰²è°ƒåˆ†å¸ƒæ•°æ®çš„æ—§åˆ†æžç»“æžœ

#### æ›´æ–°æ‚¬åœæç¤º (Updated Tooltip)
ä¿®æ”¹ `_add_hover_tooltip()` æ–¹æ³•ï¼Œä½¿ç”¨ `*bars` æŽ¥å—å¯å˜æ•°é‡çš„æŸ±çŠ¶å›¾ï¼š

```python
def _add_hover_tooltip(self, canvas, ax, x_positions, photo_names, photo_paths, *bars):
```

è¿™æ ·å¯ä»¥åŒæ—¶æ”¯æŒï¼š
- Lightness Comparison (3ä¸ªæŸ±çŠ¶å›¾)
- Hue Comparison (6ä¸ªæŸ±çŠ¶å›¾)

## ä½¿ç”¨æ–¹æ³• (Usage)

### 1. é‡æ–°åˆ†æžç…§ç‰‡
å¦‚æžœç…§ç‰‡æ˜¯æ—§åˆ†æžç»“æžœï¼ˆæ²¡æœ‰è‰²è°ƒåˆ†å¸ƒæ•°æ®ï¼‰ï¼Œéœ€è¦é‡æ–°åˆ†æžï¼š

1. åœ¨ä¸»ç•Œé¢é€‰æ‹©ç›¸å†Œæˆ–é¡¹ç›®
2. ç‚¹å‡» "âš¡ Batch Analyze" æ‰¹é‡åˆ†æž
3. ç­‰å¾…åˆ†æžå®Œæˆ

### 2. æŸ¥çœ‹ç»Ÿè®¡
1. å³é”®ç‚¹å‡»ç›¸å†Œæˆ–é¡¹ç›®
2. é€‰æ‹© "View Statistics"
3. åˆ‡æ¢åˆ° "ðŸŒˆ Hue Comparison" æ ‡ç­¾é¡µ
4. é¼ æ ‡æ‚¬åœåœ¨æŸ±çŠ¶å›¾ä¸Šå¯ä»¥é¢„è§ˆç…§ç‰‡

## æ•°æ®è§£è¯» (Data Interpretation)

### æ­£å¸¸è‚¤è‰²åˆ†å¸ƒ
å¥åº·çš„äºšæ´²è‚¤è‰²é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š
- **Normal (20-30Â°)**: å ä¸»å¯¼åœ°ä½ (50-70%)
- **Red-Orange (10-20Â°)**: é€‚ä¸­ (20-30%)
- **Very Red (0-10Â°)**: è¾ƒå°‘ (<10%)
- **Yellow (30-40Â°)**: é€‚ä¸­ (10-20%)
- **Very Yellow (40-60Â°)**: è¾ƒå°‘ (<5%)
- **Abnormal (60-350Â°)**: æžå°‘ (<2%)

### å¼‚å¸¸æƒ…å†µ
- **Very Red è¿‡é«˜**: å¯èƒ½æ˜¯å…‰çº¿è¿‡å¼ºã€çš®è‚¤å‘çº¢ã€è¡€ç®¡æ˜Žæ˜¾
- **Yellow/Very Yellow è¿‡é«˜**: å¯èƒ½æ˜¯å…‰çº¿åé»„ã€çš®è‚¤åé»„ã€é»„ç–¸
- **Abnormal è¾ƒé«˜**: å¯èƒ½æ˜¯å…‰ç…§å¼‚å¸¸ã€èƒŒæ™¯è‰²æ±¡æŸ“ã€ç®—æ³•è¯¯åˆ¤

## æŠ€æœ¯ç»†èŠ‚ (Technical Details)

### è‰²è°ƒè®¡ç®—
ä½¿ç”¨ NumPy çš„å¸ƒå°”ç´¢å¼•é«˜æ•ˆè®¡ç®—æ¯ä¸ªåŒºé—´çš„ç‚¹æ•°ï¼š

```python
hue = point_cloud[:, 0]  # Extract hue values (0-360)
hue_normal = ((hue >= 20) & (hue < 30)).sum() / len(hue) * 100
```

### é¢œè‰²é€‰æ‹©
ä½¿ç”¨æ ‡å‡† HTML é¢œè‰²ä»£ç ï¼Œæ˜“äºŽè¾¨è¯†ï¼š
- æ·±çº¢ (#8B0000): DarkRed
- æµ…çº¢ (#CD5C5C): IndianRed  
- æ£•è¤ (#D2B48C): Tan
- é‡‘é»„ (#DAA520): Goldenrod
- äº®é»„ (#FFD700): Gold
- ç°è‰² (#696969): DimGray

### æ•°æ®éªŒè¯
åœ¨ç»˜å›¾å‰ä¼šæ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§ï¼š
- è·³è¿‡ `None` å€¼
- è·³è¿‡å…¨0å€¼ï¼ˆæ—§åˆ†æžæ•°æ®ï¼‰
- è®°å½•è­¦å‘Šæ—¥å¿—

## æµ‹è¯• (Testing)

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
python test_hue_comparison.py
```

æµ‹è¯•è„šæœ¬ä¼šï¼š
1. åˆ›å»º5å¼ ç…§ç‰‡çš„æ¨¡æ‹Ÿæ•°æ®
2. æ‰“å¼€ç»Ÿè®¡çª—å£
3. æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾é¡µ
4. éªŒè¯è‰²è°ƒåˆ†å¸ƒå›¾æ­£ç¡®æ˜¾ç¤º

## ä¸‹ä¸€æ­¥æ”¹è¿› (Future Improvements)

1. **äº¤äº’å¼ç­›é€‰**: ç‚¹å‡»è‰²è°ƒåŒºé—´è‡ªåŠ¨ç­›é€‰å¯¹åº”ç…§ç‰‡
2. **å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡ºè‰²è°ƒåˆ†å¸ƒæŠ¥å‘Šä¸ºCSV/Excel
3. **å¯¹æ¯”æ¨¡å¼**: æ”¯æŒå¤šä¸ªç›¸å†Œä¹‹é—´çš„è‰²è°ƒåˆ†å¸ƒå¯¹æ¯”
4. **é˜ˆå€¼è­¦å‘Š**: å½“å¼‚å¸¸è‰²è°ƒè¶…è¿‡é˜ˆå€¼æ—¶æ˜¾ç¤ºè­¦å‘Š
5. **è‰²è°ƒè¶‹åŠ¿**: æ˜¾ç¤ºæ—¶é—´åºåˆ—ä¸Šçš„è‰²è°ƒå˜åŒ–è¶‹åŠ¿

## æ€»ç»“ (Summary)

âœ… **å®Œæˆçš„åŠŸèƒ½**:
- 6ä¸ªä¸“ä¸šå®šä¹‰çš„è‰²è°ƒåŒºé—´
- å †å æŸ±çŠ¶å›¾æ˜¾ç¤ºç™¾åˆ†æ¯”åˆ†å¸ƒ
- æ‚¬åœæ˜¾ç¤ºç…§ç‰‡ç¼©ç•¥å›¾
- æ•°æ®åº“ä¿å­˜è‰²è°ƒåˆ†å¸ƒ
- å•å¼ å’Œæ‰¹é‡åˆ†æžæ”¯æŒ

ðŸŽ¨ **ä¼˜åŠ¿**:
- æ¯”ä¼ ç»Ÿçš„è‰²è°ƒç›´æ–¹å›¾æ›´ç›´è§‚
- ç»“åˆå®žæ—¶ç…§ç‰‡é¢„è§ˆï¼Œä½¿ç”¨ä½“éªŒæžä½³
- ä¸“ä¸šçš„è‰²è°ƒåŒºé—´å®šä¹‰ï¼Œé€‚åˆè‚¤è‰²åˆ†æž
- ä¸Ž Lightness Comparison ä¸€è‡´çš„UIè®¾è®¡

ðŸ“Š **åº”ç”¨åœºæ™¯**:
- æ‰¹é‡ç…§ç‰‡è´¨é‡æ£€æŸ¥
- è‚¤è‰²ä¸€è‡´æ€§åˆ†æž
- å…‰ç…§æ¡ä»¶è¯„ä¼°
- å¼‚å¸¸ç…§ç‰‡ç­›é€‰
